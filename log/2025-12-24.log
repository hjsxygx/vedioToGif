# 操作日志 - 2025-12-24

## 今日操作记录

### 1. 基于 PRD 开发前端原型（HTML/CSS/JS 分离）
- 新增文件：
  - `index.html`：页面结构（上传/预览/切片/设置/结果下载）
  - `styles.css`：现代商务风格 + 响应式布局
  - `app.js`：交互逻辑（上传、预览、时间校验、抽帧、生成 GIF、下载）

### 2. 处理 Canvas 多次读回的性能告警
- 现象：控制台出现 `Canvas2D: Multiple readback operations ... willReadFrequently` 提示
- 原因：GIF 生成过程中会多次调用 `getImageData` 读取像素数据
- 修复：在 `app.js` 创建 2D 上下文时传入 `{ willReadFrequently: true }`，用于提示浏览器优化该类使用场景

### 3. 本地验证
- 启动静态服务器访问页面，确认页面可打开、上传视频可预览、可生成并下载 GIF

### 4. 修复“转换失败但控制台无报错”的问题
- 现象：页面提示“转换失败”，但控制台没有明确错误信息
- 原因：原逻辑吞掉异常信息；部分 MP4 在频繁 seek 抽帧时更容易失败；Worker 脚本不可用时也会导致编码失败
- 修复：
  - 抽帧增强：从“循环多次 seek 抽帧”调整为“先 seek 到起点后播放实时采样抽帧”，提升 MP4 抽帧稳定性
  - 编码增强：Worker 可用则使用，不可用自动降级到主线程编码
  - 可观测性：失败时在页面展示具体错误信息，并在控制台输出异常堆栈

### 5. 优化抽帧速度（支持倍速抽帧）
- 现象：抽取 5 秒片段制作 GIF 时等待时间偏长
- 原因：播放采样抽帧默认 1x 倍速会接近实时耗时，且频繁刷新进度会增加主线程开销
- 修复：
  - 新增“抽帧速度（1x-8x）”设置，播放采样时使用倍速抽帧以缩短等待
  - 进度更新节流（每秒约更新 2 次），减少 UI 刷新带来的额外开销
